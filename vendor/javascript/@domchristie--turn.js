function t(){return!function(){if("undefined"!=typeof window){const r=window.matchMedia("(prefers-reduced-motion: reduce)");return!r||r.matches}return!0}()}function e(r){return r.split(/[^\w]/).map(((r,c)=>0===c?r.toLowerCase():i(r))).join("")}function i(r){return r.replace(/^\w/,(r=>r.toUpperCase()))}class s{static supported=!0;direction="none";exit(){}async beforeEnter(){}async enter(){}complete(){}abort(){}finished=Promise.resolve()}class n{constructor(r){this.selector=r,this.ended=new Promise((r=>{this.resolve=r}))}async start(r){r();[...document.querySelectorAll(this.selector)].every((r=>r.getAnimations().length))?(await function(r){const c=[...document.querySelectorAll(r)];return Promise.all(c.map((r=>new Promise((c=>{r.addEventListener("animationend",(function i(){r.removeEventListener("animationend",i),c()}))})))))}(this.selector),this.resolve()):this.resolve()}}const r={animateRestore:!1};class a{constructor(c,m="none",w={}){this.action=c,this.direction=m,this.options={...r,...w},this.beforeExitClasses=new Set,this.exitClasses=new Set,this.enterClasses=new Set,this.beforeTransitionClasses=new Set,this.transitionClasses=new Set,this.forwardClasses=new Set,this.backClasses=new Set,this.noneClasses=new Set}addClasses(r){document.documentElement.classList.add(`turn-${r}`),Array.from(document.querySelectorAll(`[data-turn-${r}]`)).forEach((c=>{var m;c.dataset[`turn${m=r,m.split(/[^\w]/).map(i).join("")}`].split(/\s+/).forEach((m=>{m&&(c.classList.add(m),this[`${e(r)}Classes`].add(m))}))}))}removeClasses(r){document.documentElement.classList.remove(`turn-${r}`),Array.from(document.querySelectorAll(`[data-turn-${r}]`)).forEach((c=>{this[`${e(r)}Classes`].forEach((r=>c.classList.remove(r)))}))}dispatch(r,{target:c=document,detail:m={},bubbles:w=!0,cancelable:f=!0}={}){const p=`turn:${r}`,v=new window.CustomEvent(p,{detail:m,bubbles:w,cancelable:f});return c.dispatchEvent(v),v}}class o extends a{static supported=!0;exit(r){const c=new n("[data-turn-exit]");let m;this.animateOut=Promise.all([c.ended,new Promise((r=>{m=r}))]),this.addClasses("before-exit"),this.dispatch("before-exit",{detail:r}),window.requestAnimationFrame((()=>{c.start((()=>{this.addClasses(this.direction),this.addClasses("exit")})),this.removeClasses("before-exit"),m()}))}async beforeEnter(r){await this.animateOut,this.removeClasses("exit"),this.animateIn?await this.animateIn:this.dispatch("before-enter",{detail:{...r,action:this.action}})}enter(){const r=new n("[data-turn-enter]");return this.animateIn=r.ended,r.start((()=>this.addClasses("enter"))),this.animateIn}async complete(r){this.removeClasses("enter"),this.removeClasses(this.direction),this.dispatch("enter",{detail:{...r,action:this.action}})}abort(){this.removeClasses("before-exit"),this.removeClasses("exit"),this.removeClasses("enter"),this.removeClasses(this.direction)}get finished(){return this.animateIn}}class d extends a{static supported=!!document.startViewTransition;prepare(){return this.snapshot=new Promise((r=>{this.snapshat=r})),this.transition=document.startViewTransition((r=>this.render())),this.snapshot}exit(){}async beforeEnter(r){this.addClasses("before-transition"),this.dispatch("before-transition",{detail:{...r,action:this.action}}),await this.prepare()}render(){return this.snapshat(),new Promise((r=>{this.rendered=r}))}async enter(){this.rendered(),this.removeClasses("before-transition"),this.addClasses("transition"),await this.finished,await Promise.resolve(),this.removeClasses("transition")}complete(){}abort(){this.removeClasses("transition")}rendered(){}get finished(){return this.transition?.finished}}const c=["advance","restore","replace"];class h{constructor(r){this.config=r}start(){this.animationTurn=new s,this.viewTransitionTurn=new s,this.config,document.documentElement.classList.add(d.supported?"turn-view-transitions":"turn-no-view-transitions"),this.currentUrl=window.location.toString()}stop(){this.animationTurn.abort(),this.viewTransitionTurn.abort(),this.animationTurn=new s,this.viewTransitionTurn=new s,document.documentElement.classList.remove(d.supported?"turn-view-transitions":"turn-no-view-transitions"),delete this.initiator,delete this.currentUrl}click(r){this.initiator=r.target}submitStart(r){this.initiator=r.target}visit(r){this.reset(r),this.animationTurn=u(o,r.detail.action,r.detail.direction),this.viewTransitionTurn=u(d,r.detail.action,r.detail.direction),this.animationTurn.exit({...r.detail,referrer:this.currentUrl,initiator:this.initiator})}async beforeRender(r){r.preventDefault();const c={newBody:r.detail.newBody,referrer:this.currentUrl,initiator:this.initiator};await this.animationTurn.beforeEnter(c),this.hasPreview?await this.viewTransitionTurn.finished:await this.viewTransitionTurn.beforeEnter(c),this.isPreview&&(this.hasPreview=!0),r.detail.resume()}render(){this.currentUrl=window.location.toString(),delete this.initiator;(this.isPreview||!this.hasPreview)&&(this._render=this.viewTransitionTurn.enter().then((()=>this.animationTurn.enter())))}async load(r){await this._render,l(),this.animationTurn.complete({...r.detail,referrer:this.currentUrl})}popstate(r){"restore"!==this.animationTurn.action&&this.animationTurn.abort()}get isPreview(){return document.documentElement.hasAttribute("data-turbo-preview")}reset(r){var c;l(),c=r.detail.action,document.documentElement.classList.add(`turn-${c}`),this.hasPreview=void 0,this._render=void 0,this.animationTurn.abort(),this.viewTransitionTurn.abort(),"restore"!==r.detail.action&&this.initiator||(this.initiator=document.documentElement)}}function l(){const r=document.documentElement.classList;r.remove.apply(r,c.map((r=>`turn-${r}`)))}function u(r,c,m){r.supported&&"false"!==document.body.dataset.turn||(r=s);return new r(c,m,JSON.parse(document.body.dataset.turnOptions||"{}"))}const m={start(){if(!this.started&&t()){for(const r in w)window.addEventListener(r,w[r]);this.controller=new h(m.config),this.controller.start(),this.started=!0}},stop(){if(this.started){for(const r in w)window.removeEventListener(r,w[r]);this.controller.stop(),this.started=!1}},config:{experimental:{viewTransitions:!0}}},w={"turbo:click":function(r){this.controller.click(r)}.bind(m),"turbo:visit":function(r){this.controller.visit(r)}.bind(m),"turbo:submit-start":function(r){this.controller.submitStart(r)}.bind(m),"turbo:before-render":async function(r){this.controller.beforeRender(r)}.bind(m),"turbo:render":async function(){this.controller.render()}.bind(m),"turbo:load":async function(r){this.controller.load(r)}.bind(m),popstate:function(){this.controller.popstate()}.bind(m)};export{m as default};

